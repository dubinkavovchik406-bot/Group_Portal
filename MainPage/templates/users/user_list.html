
{% extends 'base.html' %}

{% block title %}Список користувачів{% endblock %}

{% block content %}
<div class="container main-content">
    {# Заголовок и счетчик #}
    <div class="d-flex justify-content-between align-items-center mb-4">
        <div>
            <h2 class="fw-bold m-0">Користувачі порталу</h2>
            <p class="text-muted small mb-0">Керування учасниками спільноти</p>
        </div>
        <span class="badge bg-primary rounded-pill px-3 py-2 shadow-sm">
            {{ paginator.count }} учасників
        </span>
    </div>

    {# Основная карточка с таблицей #}
    <div class="card border-0 shadow-sm overflow-hidden">
        <div class="table-responsive">
            <table class="table table-hover align-middle mb-0">
                <thead class="bg-light">
                    <tr>
                        <th class="ps-4 py-3 text-uppercase small fw-bold text-muted" style="width: 35%;">Користувач</th>
                        <th class="py-3 text-uppercase small fw-bold text-muted">Email</th>
                        <th class="py-3 text-uppercase small fw-bold text-muted">Роль</th>
                        <th class="py-3 text-uppercase small fw-bold text-muted">Статус</th>
                        <th class="py-3 text-uppercase small fw-bold text-muted text-end pe-4">Дата приєднання</th>
                    </tr>
                </thead>
                <tbody>
                    {% for user_item in users_objects %}
                    <tr class="position-relative">
                        <td class="ps-4 py-3">
                            <div class="d-flex align-items-center">
                                <div class="avatar-circle me-3">
                                    {{ user_item.username|first|upper }}
                                </div>
                                <div>
                                    <a href="{% url 'user-detail' user_item.pk %}" class="fw-bold text-dark text-decoration-none stretched-link">
                                        {{ user_item.username }}
                                    </a>
                                    <br>
                                    <small class="text-muted">ID: #{{ user_item.id }}</small>
                                </div>
                            </div>
                        </td>

                        <td class="text-muted">
                            {# Админ видит email всех пользователей в этом списке для управления #}
                            {{ user_item.email|default:"—" }}
                        </td>

                        <td>
                            {% if user_item.is_admin %}
                                <span class="badge bg-danger-subtle text-danger border border-danger-subtle px-3">Адміністратор</span>
                            {% elif user_item.is_moderator %}
                                <span class="badge bg-warning-subtle text-warning-emphasis border border-warning-subtle px-3">Модератор</span>
                            {% else %}
                                <span class="badge bg-light text-dark border px-3">Учасник</span>
                            {% endif %}
                        </td>

                        <td>
                            {% if user_item.is_active %}
                                <div class="d-flex align-items-center">
                                    <span class="badge-dot bg-success me-2"></span>
                                    <span class="small text-dark">Активний</span>
                                </div>
                            {% else %}
                                <div class="d-flex align-items-center text-muted">
                                    <span class="badge-dot bg-secondary me-2"></span>
                                    <span class="small">Заблокований</span>
                                </div>
                            {% endif %}
                        </td>

                        <td class="text-muted small text-end pe-4">
                            {{ user_item.date_joined|date:"d.m.Y" }}
                        </td>
                    </tr>
                    {% empty %}
                    <tr>
                        <td colspan="5" class="text-center py-5">
                            <p class="text-muted m-0">Користувачів поки немає...</p>
                        </td>
                    </tr>
                    {% endfor %}
                </tbody>
            </table>
        </div>
    </div>

    {# Блок пагінації #}
    {% if is_paginated %}
    <nav aria-label="Навігація" class="mt-4">
        <ul class="pagination justify-content-center">

            {# Стрелочка НАЗАД #}
            {% if page_obj.has_previous %}
                <li class="page-item">
                    <a class="page-link shadow-sm border-0 rounded-3 me-1" href="?page={{ page_obj.previous_page_number }}">
                        <i class="bi bi-chevron-left"></i>
                    </a>
                </li>
            {% else %}
                {# Если предыдущей страницы нет, кнопка просто заблокирована #}
                <li class="page-item disabled me-1">
                    <span class="page-link shadow-sm border-0 rounded-3 text-muted opacity-50">
                        <i class="bi bi-chevron-left"></i>
                    </span>
                </li>
            {% endif %}

            {# Список номеров страниц #}
            {% for num in page_obj.paginator.page_range %}
                {% if page_obj.number == num %}
                    <li class="page-item active me-1">
                        <span class="page-link border-0 rounded-3 shadow-sm">{{ num }}</span>
                    </li>
                {% elif num > page_obj.number|add:'-3' and num < page_obj.number|add:'3' %}
                    <li class="page-item me-1">
                        <a class="page-link border-0 rounded-3 shadow-sm" href="?page={{ num }}">{{ num }}</a>
                    </li>
                {% endif %}
            {% endfor %}

            {# Стрелочка ВПЕРЕД #}
            {% if page_obj.has_next %}
                <li class="page-item">
                    <a class="page-link shadow-sm border-0 rounded-3" href="?page={{ page_obj.next_page_number }}">
                        <i class="bi bi-chevron-right"></i>
                    </a>
                </li>
            {% else %}
                {# Если следующей страницы нет, кнопка заблокирована #}
                <li class="page-item disabled">
                    <span class="page-link shadow-sm border-0 rounded-3 text-muted opacity-50">
                        <i class="bi bi-chevron-right"></i>
                    </span>
                </li>
            {% endif %}

        </ul>
    </nav>
    {% endif %}
</div>
{% endblock %}